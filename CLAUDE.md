# Claude Instructions for docrev

This is `docrev` (command: `rev`), a CLI tool for academic paper workflows with Word â†” Markdown round-trips.

## Key Commands for Claude

### Replying to Comments
When helping the user address reviewer comments, use the non-interactive reply mode:

```bash
# Reply to a specific comment by number
rev reply <file> -n <number> -m "Your response"

# Example
rev reply methods.md -n 1 -m "Added clarification about sampling methodology in paragraph 2"
```

The user's name is already configured via `rev config user`. Replies appear as:
```markdown
{>>Reviewer: Original comment<<} {>>User Name: Your reply<<}
```

### Viewing Comments
```bash
rev comments <file>       # List all comments with context
rev status <file>         # Show annotation counts
```

### Building Documents
```bash
rev build                 # Build PDF and DOCX
rev build pdf             # PDF only
rev build docx            # DOCX only
```

## Annotation Syntax (CriticMarkup)

- `{++inserted text++}` - Additions
- `{--deleted text--}` - Deletions
- `{~~old~>new~~}` - Substitutions
- `{>>Author: comment<<}` - Comments

## Cross-References

Use dynamic references in markdown:
- `@fig:label` - Figure reference (becomes "Figure 1" in Word)
- `@tbl:label` - Table reference
- `{#fig:label}` - Anchor for figures

## Project Structure

- `rev.yaml` - Project configuration
- `*.md` - Section files (introduction.md, methods.md, etc.)
- `paper.md` - Combined output (generated by build)
- `figures/` - Images directory

### DOI Management
```bash
rev doi check references.bib     # Validate DOIs (Crossref + DataCite)
rev doi lookup references.bib    # Find missing DOIs by title/author/year
rev doi fetch <doi>              # Get BibTeX from DOI
rev doi add <doi>                # Add citation to .bib file
```

Options:
- `--confidence low|medium|high` - Filter lookup results by confidence
- `--strict` - Fail if articles are missing DOIs
- Skip entries: add `nodoi = {true}` or `% no-doi` comment before entry

## Workflow Tips

1. When user imports a reviewed Word doc, help them go through comments
2. Use `rev reply` to respond to each comment as you address it
3. After addressing all comments, run `rev build docx` to generate updated Word doc
4. Use `rev doi check` to validate bibliography before submission
